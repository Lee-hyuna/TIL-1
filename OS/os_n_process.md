# 운영체제란?

1) 자원관리 역할 : CPU, 메모리, 저장장치, I/O장치 등 자원을 관리

2) 추상화 역할 : 사용자에게 보다 좋고 단순, 깨끗한 모델을 제시.

# 프로세스란?

프로세스는 **현재 처리 중에 있는 프로그램**으로 컴퓨터에서 유일한 `능동적 객체` 이다.

다른 프로세스를 생성하기도 죽이기도 한다.

>  프로그램 = 코드
>
>  프로세스 = 행위(진행과정)

#### 프로세스 상태

![img](http://www.pling.org.uk/cs/opsimg/processstates.png)

대기 - (조건 만족) - 준비 - (대기열) - 실행(CPU 소유) - 대기 OR 준비로 `문맥교환`

#### 문맥교환(Context Switch) 발생

**다중 프로그래밍 시스템**에서 실행하고 있던 한 프로그램에서 다른 프로그램으로 CPU가 옮겨 갈때를 말한다.

*다중프로그래밍이란? CPU 작업과 입출력 작업을 병행하는 것*

![img](http://i.imgur.com/zh4JjZv.png)

#### 문맥 교환은 언제 발생하나?

인터럽트(I/O 입력 혹은 다중프로그래밍 위한 프로세스 교체 필요) 발생시에 문맥교환이 시작된다.

> 문맥교환이 발생한다면 아직 작업이 끝나지 않았으므로, 일어나는 정확한 때에 정확한 사진(프로세스의 현재 문맥)을 찍어놓아야 복구할 수 있음.

#### 문맥 교환의 과정

1. 문맥을 PCB(Process Control Block)에 프로세스 식별자, CPU 레지스터 값, 프로세스 상태(생성, 준비, 실행), 메모리 관리 정보등을 저장. 

   *PCB는 특정 프로세스를 관리하는 운영체제 커널의 자료구조이다.*

2. 프로세스 스케줄러에서 다음 프로세스를 준비 큐에서 선택

3. 다음 프로세스를 PCB에서 복구


문맥교환은 오버헤드가 있기 때문에, 프로세스 보다 가벼운 스레드를 이용하여 문맥교환의 부하를 최소화할 수 있다.

#### 스레드란?

코드의 실행을 하나의 흐름으로 보고, 여러 흐름으로 진행. `준병렬적 수행`

- 하나의 주소 공간을 공유 : 모든 데이터 공유, 중복 연산 겹쳐서 수행가능, 프로세스보다 생성 제거 쉬움

# 프로세스간 통신

#### 쟁점

1. 어떻게 다른 프로세스에게 정보를 전달하는가?
2. 프로세스들 서로 방해받지 않아야 한다.
3. 서로 연관(종속성)시 적절한 순서를 정해야 한다.

#### 경쟁조건

공유된 정보 사용시 누가, 언제 수행되는가에 따라 정보가 달라진다.

> 회피법 : 상호배제

#### 상호배제

한 프로세스가 공유 변수나 파일 사용시, 다른 프로세스가 똑같은 일 수행 못하도록 하는 것. -> 임계구역 정의 필요

#### 임계구역

공유 메모리를 접근하는 프로그램 부분

##### 임계구역의 조건

- 두개 프로세스가 동시에 자기 임계구역 내에 존재하는 경우 없어야 함.
- CPU의 개수나 속도에 대해 어떤 가정도 하지 않아야 함.
- 임계구역 외부에서 실행중인 프로세스는 다른 프로세스들을 블록해서는 안됌.
- 임계구역 진입 위해 무한히 기다리는 프로세스 없어야 함.

#### 해결책

1. 인터럽트 끄기 : 임계구역 진입하자 마자 인터럽트 끄고, 나가기 직전 인터럽트 킴.

> 문맥교환이 발생하지 않음, 그러나 사용자에게 인터럽트 끌 권한 주는 것은 너무 위험하며 다중 CPU에서는 소용이 없음

2. lock 변수

> lock 자체가 공유 변수, 똑같은 문제 발생

3. TSL(Test and Set Lock)

> CPU가 메모리에 접근 못하도록 메모리 버스를 잠금. 결과적으로 atomic하게(문맥교환없이) 이루어짐.

4. 세마포어(Semaphore)

세마포어는 원자적으로 제어되는 정수 변수. 세마포어의 값이 0보다 크면 접근함과 동시에 세마포어의 값을 1 감소시킴. 종료하고 나갈 때는 값을 1 증가시켜 다른 프로세스가 접근할 수 있도록 함.

5. 뮤텍스(Mutext)

세마포어의 개수 세는 능력을 제거하고, 값이 1인 세마포어와 같음.

> 4, 5번 역시 식사하는 철학자 문제처럼 모든 교착 상태에 대한 해답을 제시해줄 수 없다. 헤츠허르 데이크스트라의 해결책은, 한 명은 먼저 반대의 숟가락를 먼저 집는 방식으로 교착상태를 막는다고 한다. 즉 대칭성을 제거하는 것.

*교착상태(deadlock) : 두 개 이상의 작업이 서로 상대방의 작업이 끝나기만을 기다리고 있어서 결과적으로 아무것도 완료되지 못하는 상태*

6. 모니터(Monitor)

세마포어, 뮤텍스를 좀 더 사용하기 쉽게 만든것.

## Refrence

운영체제론 - 노삼혁, 이동희, 전흥석

문맥교환 : http://seedyoon.tistory.com/entry/%EC%BB%A8%ED%85%8D%EC%8A%A4%ED%8A%B8-%EC%8A%A4%EC%9C%84%EC%B9%ADContext-Switching

PCB : https://ko.wikipedia.org/wiki/%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4_%EC%A0%9C%EC%96%B4_%EB%B8%94%EB%A1%9D

문맥교환 과정 : http://i-bada.blogspot.kr/2012/04/context-switch.html

세마포어 : https://ko.wikipedia.org/wiki/%EC%84%B8%EB%A7%88%ED%8F%AC%EC%96%B4

식사하는 철학자 문제 : https://ko.wikipedia.org/wiki/%EC%8B%9D%EC%82%AC%ED%95%98%EB%8A%94_%EC%B2%A0%ED%95%99%EC%9E%90%EB%93%A4_%EB%AC%B8%EC%A0%9C
